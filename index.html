<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moto Lucro</title>

<style>
body { font-family: Arial, sans-serif; background:#f2f2f7; padding:20px; }
h1 { text-align:center; }

.dashboard {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-bottom:20px;
}

.box {
  background:white;
  padding:12px;
  border-radius:10px;
  text-align:center;
}

.box strong { display:block; font-size:18px; }

input, button {
  width:100%;
  padding:12px;
  margin:6px 0;
  font-size:16px;
}

button {
  background:#007aff;
  color:white;
  border:none;
  border-radius:8px;
}

.card {
  background:white;
  padding:15px;
  border-radius:10px;
  margin-top:15px;
}

.lucro { color:green; font-weight:bold; }
.prejuizo { color:red; font-weight:bold; }
.small { font-size:14px; color:#555; }

.edit { background:#ff9500; }
.delete { background:#ff3b30; }
.sell { background:#34c759; }

.gasto {
  background:#f1f1f1;
  padding:8px;
  border-radius:6px;
  margin-top:5px;
}

.filters button {
  background:#e5e5ea;
  color:black;
}
</style>
</head>

<body>

<h1>üèçÔ∏è Moto Lucro</h1>

<!-- DASHBOARD -->
<div class="dashboard">
  <div class="box">Total investido<strong id="totalInvestido">R$ 0,00</strong></div>
  <div class="box">Total vendido<strong id="totalVendido">R$ 0,00</strong></div>
  <div class="box">Lucro total<strong id="lucroTotal">R$ 0,00</strong></div>
  <div class="box">Motos cadastradas<strong id="qtdMotos">0</strong></div>
</div>

<!-- CADASTRO -->
<div class="card">
<input id="modelo" placeholder="Modelo da moto">
<input id="compra" placeholder="Valor de compra (R$)">
<input id="pecas" placeholder="Pe√ßas / manuten√ß√£o (R$)">
<input id="doc" placeholder="Documenta√ß√£o (R$)">
<input id="venda" placeholder="Valor de venda (R$)">
<button onclick="salvar()">Salvar</button>
</div>

<!-- FILTROS -->
<div class="filters">
<button onclick="filtro='todas'; listar()">üìä Todas</button>
<button onclick="filtro='estoque'; listar()">üì¶ Em estoque</button>
<button onclick="filtro='vendidas'; listar()">üí∞ Vendidas</button>
</div>

<h2>üìã Hist√≥rico</h2>
<div id="lista"></div>

<script>
let motos = JSON.parse(localStorage.getItem("motos")) || [];
let editIndex = null;
let filtro = "todas";

function valorNumero(v) {
  if (!v) return 0;
  return Number(v.replace(/\./g, '').replace(',', '.'));
}

function salvar() {
  let moto = {
    modelo: modelo.value,
    compra: valorNumero(compra.value),
    pecas: valorNumero(pecas.value),
    doc: valorNumero(doc.value),
    venda: valorNumero(venda.value),
    gastos: [],
    status: "estoque"
  };

  if (editIndex !== null) {
    moto.gastos = motos[editIndex].gastos;
    moto.status = motos[editIndex].status;
    motos[editIndex] = moto;
    editIndex = null;
  } else {
    motos.push(moto);
  }

  salvarLocal();
  limpar();
  listar();
}

function adicionarGasto(i) {
  let desc = prompt("Descri√ß√£o do gasto:");
  let valor = prompt("Valor do gasto:");
  if (!desc || !valor) return;
  motos[i].gastos.push({ desc, valor: valorNumero(valor) });
  salvarLocal();
  listar();
}

function totalExtras(m) {
  return m.gastos.reduce((s, g) => s + g.valor, 0);
}

function listar() {
  lista.innerHTML = "";

  let totalInvestido = 0;
  let totalVendido = 0;
  let lucroTotal = 0;

  motos.forEach((m, i) => {
    if (
      filtro === "estoque" && m.status !== "estoque" ||
      filtro === "vendidas" && m.status !== "vendida"
    ) return;

    let extras = totalExtras(m);
    let investido = m.compra + m.pecas + m.doc + extras;
    let lucro = m.venda - investido;

    totalInvestido += investido;
    if (m.status === "vendida") {
      totalVendido += m.venda;
      lucroTotal += lucro;
    }

    let classe = lucro >= 0 ? "lucro" : "prejuizo";

    lista.innerHTML += `
      <div class="card">
        <strong>${m.modelo}</strong>
        <p class="small">Status: ${m.status === "estoque" ? "üì¶ Em estoque" : "üí∞ Vendida"}</p>
        <p class="small">Investido: R$ ${investido.toFixed(2)}</p>
        <p class="small">Venda: R$ ${m.venda.toFixed(2)}</p>
        ${m.status === "vendida" ? `<p class="${classe}">Resultado: R$ ${lucro.toFixed(2)}</p>` : ""}
        
        ${m.gastos.map(g => `<div class="gasto">‚Ä¢ ${g.desc}: R$ ${g.valor.toFixed(2)}</div>`).join("")}

        <button onclick="adicionarGasto(${i})">Adicionar gasto</button>
        ${m.status === "estoque" ? `<button class="sell" onclick="vender(${i})">Marcar como vendida</button>` : ""}
        <button class="edit" onclick="editar(${i})">Editar</button>
        <button class="delete" onclick="remover(${i})">Excluir</button>
      </div>
    `;
  });

  document.getElementById("totalInvestido").innerText = `R$ ${totalInvestido.toFixed(2)}`;
  document.getElementById("totalVendido").innerText = `R$ ${totalVendido.toFixed(2)}`;
  document.getElementById("lucroTotal").innerText = `R$ ${lucroTotal.toFixed(2)}`;
  document.getElementById("qtdMotos").innerText = motos.length;
}

function vender(i) {
  motos[i].status = "vendida";
  salvarLocal();
  listar();
}

function editar(i) {
  let m = motos[i];
  modelo.value = m.modelo;
  compra.value = m.compra;
  pecas.value = m.pecas;
  doc.value = m.doc;
  venda.value = m.venda;
  editIndex = i;
}

function remover(i) {
  if (confirm("Excluir esta moto?")) {
    motos.splice(i, 1);
    salvarLocal();
    listar();
  }
}

function salvarLocal() {
  localStorage.setItem("motos", JSON.stringify(motos));
}

function limpar() {
  modelo.value = compra.value = pecas.value = doc.value = venda.value = "";
}

listar();
</script>

</body>
</html>