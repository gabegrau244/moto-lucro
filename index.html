<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moto Lucro</title>

<style>
body { font-family: Arial, sans-serif; background:#f2f2f7; padding:20px; }
h1 { text-align:center; }
input, button { width:100%; padding:12px; margin:6px 0; font-size:16px; }
button { background:#007aff; color:white; border:none; border-radius:8px; }
.card { background:white; padding:15px; border-radius:10px; margin-top:15px; }
.lucro { color:green; font-weight:bold; }
.prejuizo { color:red; font-weight:bold; }
.small { font-size:14px; color:#555; }
.edit { background:#ff9500; }
.delete { background:#ff3b30; }
.gasto { background:#f1f1f1; padding:8px; border-radius:6px; margin-top:5px; }
</style>
</head>

<body>

<h1>üèçÔ∏è Moto Lucro</h1>

<div class="card">
<input id="modelo" placeholder="Modelo da moto">
<input id="compra" placeholder="Valor de compra (R$)">
<input id="pecas" placeholder="Pe√ßas / manuten√ß√£o (R$)">
<input id="doc" placeholder="Documenta√ß√£o (R$)">
<input id="venda" placeholder="Valor de venda (R$)">
<button onclick="salvar()">Salvar</button>
</div>

<h2>üìã Hist√≥rico</h2>
<div id="lista"></div>

<script>
let motos = JSON.parse(localStorage.getItem("motos")) || [];
let editIndex = null;

function valorNumero(v) {
  if (!v) return 0;
  return Number(v.replace(/\./g, '').replace(',', '.'));
}

function salvar() {
  if (!modelo.value || !compra.value) {
    alert("Preencha modelo e valor de compra");
    return;
  }

  let moto = {
    modelo: modelo.value,
    compra: valorNumero(compra.value),
    pecas: valorNumero(pecas.value),
    doc: valorNumero(doc.value),
    venda: valorNumero(venda.value),
    gastos: []
  };

  if (editIndex !== null) {
    moto.gastos = motos[editIndex].gastos;
    motos[editIndex] = moto;
    editIndex = null;
  } else {
    motos.push(moto);
  }

  salvarLocal();
  limpar();
  listar();
}

function adicionarGasto(i) {
  let desc = prompt("Descri√ß√£o do gasto:");
  let valor = prompt("Valor do gasto:");

  if (!desc || !valor) return;

  motos[i].gastos.push({
    desc,
    valor: valorNumero(valor)
  });

  salvarLocal();
  listar();
}

function totalGastosExtras(m) {
  return m.gastos.reduce((s, g) => s + g.valor, 0);
}

function listar() {
  lista.innerHTML = "";

  motos.forEach((m, i) => {
    let extras = totalGastosExtras(m);
    let total = m.compra + m.pecas + m.doc + extras;
    let lucro = m.venda - total;
    let classe = lucro >= 0 ? "lucro" : "prejuizo";

    lista.innerHTML += `
      <div class="card">
        <strong>${m.modelo}</strong>
        <p class="small">Compra: R$ ${m.compra.toFixed(2)}</p>
        <p class="small">Pe√ßas: R$ ${m.pecas.toFixed(2)}</p>
        <p class="small">Documenta√ß√£o: R$ ${m.doc.toFixed(2)}</p>
        <p class="small">Gastos extras: R$ ${extras.toFixed(2)}</p>
        <p class="small">Venda: R$ ${m.venda.toFixed(2)}</p>
        <p class="${classe}">Resultado: R$ ${lucro.toFixed(2)}</p>

        ${m.gastos.map(g => `
          <div class="gasto">‚Ä¢ ${g.desc}: R$ ${g.valor.toFixed(2)}</div>
        `).join("")}

        <button onclick="adicionarGasto(${i})">Adicionar gasto</button>
        <button class="edit" onclick="editar(${i})">Editar</button>
        <button class="delete" onclick="remover(${i})">Excluir</button>
      </div>
    `;
  });
}

function editar(i) {
  let m = motos[i];
  modelo.value = m.modelo;
  compra.value = m.compra;
  pecas.value = m.pecas;
  doc.value = m.doc;
  venda.value = m.venda;
  editIndex = i;
}

function remover(i) {
  if (confirm("Excluir esta moto?")) {
    motos.splice(i, 1);
    salvarLocal();
    listar();
  }
}

function salvarLocal() {
  localStorage.setItem("motos", JSON.stringify(motos));
}

function limpar() {
  modelo.value = compra.value = pecas.value = doc.value = venda.value = "";
}

listar();
</script>

</body>
</html>